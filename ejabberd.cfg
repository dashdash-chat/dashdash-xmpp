%%%
%%%               ejabberd configuration file
%%%
%%%'

%%% The parameters used in this configuration file are explained in more detail
%%% in the ejabberd Installation and Operation Guide.
%%% Please consult the Guide in case of doubts, it is included with
%%% your copy of ejabberd, and is also available online at
%%% http://www.process-one.net/en/ejabberd/docs/


%%%.   =======================
%%%'   OVERRIDE STORED OPTIONS
%%
%% Override the old values stored in the database.
%%
%%
%% Override global options (shared by all ejabberd nodes in a cluster).
%%
%%override_global.
%%
%% Override local options (specific for this particular ejabberd node).
%%
%%override_local.
%%
%% Remove the Access Control Lists before new ones are added.
%%
%%override_acls.


%%%.   =========
%%%'   DEBUGGING
%%
%% loglevel: Verbosity of log files generated by ejabberd.
%% 0: No ejabberd log at all (not recommended)
%% 1: Critical
%% 2: Error
%% 3: Warning
%% 4: Info
%% 5: Debug
%%
{loglevel, 4}.
%%
%% watchdog_admins: Only useful for developers: if an ejabberd process
%% consumes a lot of memory, send live notifications to these XMPP
%% accounts.
%%
{watchdog_admins, ["admin1@localhost"]}.


%%%.   ================
%%%'   SERVED HOSTNAMES
%%
%% hosts: Domains served by ejabberd.
%% You can define one or several, for example:
%% {hosts, ["example.net", "example.com", "example.org"]}.
%%
{hosts, ["localhost"]}.
%%
%% route_subdomains: Delegate subdomains to other XMPP servers.
%% For example, if this ejabberd serves example.org and you want
%% to allow communication with an XMPP server called im.example.org.
%%
%%{route_subdomains, s2s}.


%%%.   ===============
%%%'   LISTENING PORTS
%%
%% listen: The ports ejabberd will listen on, which service each is handled
%% by and what options to start it with.
%%
{listen,
 [
  {5222, ejabberd_c2s, [
			%%
			%% If TLS is compiled in and you installed a SSL
			%% certificate, specify the full path to the
			%% file and uncomment this line:
			%%
			%%{certfile, "/path/to/ssl.pem"}, starttls,
			{access, c2s},
			{shaper, c2s_shaper},
			{max_stanza_size, 65536}
  ]},
  %%
  %% To enable the old SSL connection method on port 5223:
  %%
  %%{5223, ejabberd_c2s, [
  %%			{access, c2s},
  %%			{shaper, c2s_shaper},
  %%			{certfile, "/path/to/ssl.pem"}, tls,
  %%			{max_stanza_size, 65536}
  %%		       ]},
  %%
  %% To enable incoming server-to-server traffic, uncomment this:
  %%
  %% {5269, ejabberd_s2s_in, [
  %% 			   {shaper, s2s_shaper},
  %% 			   {max_stanza_size, 131072}
  %% 			  ]},
  %%
  %% ejabberd_service: Interact with external components (transports, ...)
  %%
  {5237, ejabberd_service, [
  			    {hosts, ["bot.localhost"],
  			     [{password, "yeij9bik9fard3ij4bai"}]
  			    }
  ]},
  %%
  %% ejabberd_stun: Handles STUN Binding requests
  %%
  %%{{3478, udp}, ejabberd_stun, []},
  {5280, ejabberd_http, [
			 %%{request_handlers,
			 %% [
			 %%  {["pub", "archive"], mod_http_fileserver}
			 %% ]},
			 captcha,
			 http_bind,
			 http_poll,
			 %%register,
			 web_admin
  ]},
  %%
  %% ejabberd_xmlrpc
  %%
  {4560, ejabberd_xmlrpc, [
  			    {maxsessions, infinity},
  			    {timeout, 5000},
				{access_commands, [
			    	{xmlrpc_hostbots, [register, unregister], []},
			    	{xmlrpc_proxybots, [add_rosteritem, delete_rosteritem, user_sessions_info], []}
				]}
  ]}
 ]}.
%%
%% Allow or deny communication with specific servers.
%%
%%{{s2s_host, "goodhost.org"}, allow}.
%%{{s2s_host, "badhost.org"}, deny}.
{s2s_default_policy, deny}.


%%%.   ==============
%%%'   AUTHENTICATION
%%
%% auth_method: Method used to authenticate the users.
%% The default method is the internal.
%% If you want to use a different method,
%% comment this line and enable the correct ones.
%%
{auth_method, internal}.
%%
%% Store the plain passwords or hashed for SCRAM:
%%{auth_password_format, plain}.
%%{auth_password_format, scram}.
%%
%% Define the FQDN if ejabberd doesn't detect it:
%%{fqdn, "server3.example.com"}.


%%%.   ===============
%%%'   TRAFFIC SHAPERS
%%
%% The "normal" shaper limits traffic speed to 1000 B/s
%%
{shaper, normal, {maxrate, 1000}}.
%%
%% The "fast" shaper limits traffic speed to 50000 B/s
%%
{shaper, fast, {maxrate, 50000}}.
%%
%% This option specifies the maximum number of elements in the queue
%% of the FSM. Refer to the documentation for details.
%%
{max_fsm_queue, 1000}.


%%%.   ====================
%%%'   ACCESS CONTROL LISTS
%%
%% The 'admin' ACL grants administrative privileges to XMPP accounts.
%% You can put here as many accounts as you want.
%%
{acl, admin, {user, "admin1", "localhost"}}.
%%
%% Blocked users
%%
%%{acl, blocked, {user, "baduser", "example.org"}}.
%%{acl, blocked, {user, "test"}}.
%%
%% Local users: don't modify this line.
%%
{acl, local, {user_regexp, ""}}.

%%
%% Chatidea access control lists
%%
{acl, hostbot_user, {user, "host", "localhost"}}. % NOTE this does not also capture host@bot.localhost
{acl, proxybot_users, {user_regexp, "^proxy"}}.


%%%.   ============
%%%'   ACCESS RULES
%%
%% Maximum number of simultaneous sessions allowed for a single user:
{access, max_user_sessions, [{10, all}]}.
%%
%% Maximum number of offline messages that users can have:
{access, max_user_offline_messages, [{5000, admin}, {100, all}]}.
%%
%% This rule allows access only for local users:
{access, local, [{allow, local}]}.
%%
%% Only non-blocked users can use c2s connections:
{access, c2s, [{deny, blocked}, {allow, all}]}.
%%
%% For C2S connections, all users except admins use the "normal" shaper
{access, c2s_shaper, [{none, admin}, {normal, all}]}.
%%
%% All S2S connections use the "fast" shaper
{access, s2s_shaper, [{fast, all}]}.
%%
%% Only admins can send announcement messages:
{access, announce, [{allow, admin}]}.
%%
%% Only admins can use the configuration interface:
{access, configure, [{allow, admin}]}.
%%
%% Admins of this server are also admins of the MUC service:
{access, muc_admin, [{allow, admin}]}.
%%
%% Only accounts of the local ejabberd server can create rooms:
{access, muc_create, [{allow, local}]}.
%%
%% All users are allowed to use the MUC service:
{access, muc, [{allow, all}]}.
%%
%% Only accounts on the local ejabberd server can create Pubsub nodes:
{access, pubsub_createnode, [{allow, local}]}.
%%
%% In-band registration allows registration of any possible username.
%% To disable in-band registration, replace 'allow' with 'deny'.
{access, register, [{deny, all}]}.
%%
%% By default the frequency of account registrations from the same IP
%% is limited to 1 account every 10 minutes. To disable, specify: infinity
{registration_timeout, infinity}.
%%
%% Chatidea access rules
%%
{access, xmlrpc_hostbots, [{allow, admin}, {allow, hostbot_user}, {deny, all}]}.
{access, xmlrpc_proxybots, [{allow, admin}, {allow, proxybot_users}, {deny, all}]}.


%%%.   ================
%%%'   DEFAULT LANGUAGE
%%
%% language: Default language used for server messages.
%%
{language, "en"}.


%%%.   =======
%%%'   MODULES
%%
%% Modules enabled in all ejabberd virtual hosts.
%%
{modules,
 [
  {mod_adhoc,     []},
  {mod_announce,  [{access, announce}]}, % recommends mod_adhoc
  {mod_blocking,  []}, % requires mod_privacy
  {mod_caps,      []},
  {mod_configure, []}, % requires mod_adhoc
  {mod_disco,     []},
  %%{mod_echo,    [{host, "echo.localhost"}]},
  {mod_irc,       []},
  {mod_http_bind, []},
  %%{mod_http_fileserver, [
  %%                       {docroot, "/var/www"},
  %%                       {accesslog, "/var/log/ejabberd/access.log"}
  %%                      ]},
  {mod_last,      []},
  %%{mod_muc_log, []},
  {mod_offline,   [{access_max_user_messages, max_user_offline_messages}]},
  {mod_ping,      []},
  %%{mod_pres_counter,[{count, 5}, {interval, 60}]},
  {mod_privacy,   []},
  {mod_private,   []},
  %%{mod_proxy65, []},
  {mod_pubsub,    [
		  {access_createnode, pubsub_createnode},
		  {ignore_pep_from_offline, true}, % reduces resource comsumption, but XEP incompliant
		  %%{ignore_pep_from_offline, false},  % XEP compliant, but increases resource comsumption
		  {last_item_cache, false},
		  {plugins, ["flat", "hometree", "pep"]}  % pep requires mod_caps
		 ]},
  {mod_roster,    []},
  %%{mod_service_log,[]},
  {mod_shared_roster,[]},
  {mod_stats,     []},
  {mod_time,      []},
  {mod_vcard,     []},
  {mod_version,   []},
  %% {mod_multicast, []},
  {mod_register, [{access, register}]}, %% let existing accounts change their passwords via in-band registration
  {mod_admin_extra, []}
 ]}.


%%%.
%%%'

%%% $Id$

%%% Local Variables:
%%% mode: erlang
%%% End:
%%% vim: set filetype=erlang tabstop=8 foldmarker=%%%',%%%. foldmethod=marker:
