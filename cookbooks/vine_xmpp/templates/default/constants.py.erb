import logging
import shortuuid
shortuuid.set_alphabet('1234567890abcdefghijklmnopqrstuvwxyz')

domain = '<%= node.run_state['config']['domain'] %>'
server_ip = '<%= node.run_state['config']['xmlrpc']['ip'] %>'
xmlrpc_server = '<%= node.run_state['config']['xmlrpc']['domain'] %>'

component_port = <%= node.run_state['config']['leaves']['port'] %>
leaves_domain = '%s.%s' % ('<%= node.run_state['config']['leaves']['subdomain'] %>', domain)
leaves_jid_user = '<%= node.run_state['config']['leaves']['jid_user'] %>'
leaves_jid = '%s@%s' % (leaves_jid_user, leaves_domain)
leaves_secret = '<%= node.run_state['config']['leaves']['secret'] %>'
max_leaves = <%= node.run_state['config']['leaves']['max_leaves'] %>

xmlrpc_port = <%= node.run_state['config']['xmlrpc']['port'] %>
leaves_xmlrpc_user = '<%= node.run_state['config']['xmlrpc']['leaves_user'] %>'
leaves_xmlrpc_password = '<%= node.run_state['config']['xmlrpc']['leaves_password'] %>'

leaves_mysql_user = '<%= node.run_state['config']['mysql']['leaves_user'] %>'
leaves_mysql_lock_name = 'leaf'
leaves_mysql_password ='<%= node.run_state['config']['mysql']['leaves_password'] %>'
db_host = '<%= node.run_state['config']['mysql']['host'] %>'
db_name = '<%= node.run_state['config']['mysql']['main_name'] %>'

vinebot_prefix = 'vinebot_'

admin_jids = ['%s@%s' % (user, domain) for user in <%= node.run_state['config']['xmpp_users']['admins'] %>]
graph_xmpp_jid = '%s@%s' % ('<%= node.run_state['config']['xmlrpc']['graph_user'] %>', domain)

watched_usernames = <%= node.run_state['config']['twilio']['watched_usernames'] %>
twilio_account_sid = '<%= node.run_state['config']['twilio']['account_sid'] %>'
twilio_auth_token = '<%= node.run_state['config']['twilio']['auth_token'] %>'
twilio_from_number = '<%= node.run_state['config']['twilio']['from_number'] %>'
twilio_to_numbers = <%= node.run_state['config']['twilio']['to_numbers'] %>

client_port = <%= node.run_state['config']['xmpp_users']['port'] %>
echo_user = '<%= node.run_state['config']['xmpp_users']['echo_user'] %>'
default_user_password = '<%= node.run_state['config']['xmpp_users']['default_password'] %>'

log_format = '%(asctime)-15s %(name)s %(levelname)-7s - %(message)s'

# global variables to save the hassle of passing around the values
class g(object):
    loglevel = None
    logger = None
    db = None 
    ectl = None
    
    @classmethod
    def use_new_logger(self, name):
        formatter = logging.Formatter(log_format)
        ch = logging.StreamHandler()
        ch.setLevel(logging.DEBUG)
        ch.setFormatter(formatter)
        g.logger = logging.getLogger(name)
        g.logger.setLevel(g.loglevel)
        g.logger.propagate = False  # otherwise the main logging.info (or whatever) gets called too. ugh this was annoying to figure out.
        g.logger.addHandler(ch)
